"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/documents/upload/route";
exports.ids = ["app/api/documents/upload/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Fupload%2Froute&page=%2Fapi%2Fdocuments%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Fupload%2Froute.ts&appDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Fupload%2Froute&page=%2Fapi%2Fdocuments%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Fupload%2Froute.ts&appDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_lokesh_Documents_Agent_Army_Estimator_AI_agent_frontend_app_api_documents_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/documents/upload/route.ts */ \"(rsc)/./app/api/documents/upload/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/documents/upload/route\",\n        pathname: \"/api/documents/upload\",\n        filename: \"route\",\n        bundlePath: \"app/api/documents/upload/route\"\n    },\n    resolvedPagePath: \"/Users/lokesh/Documents/Agent_Army/Estimator_AI_agent/frontend/app/api/documents/upload/route.ts\",\n    nextConfigOutput,\n    userland: _Users_lokesh_Documents_Agent_Army_Estimator_AI_agent_frontend_app_api_documents_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/documents/upload/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZkb2N1bWVudHMlMkZ1cGxvYWQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmRvY3VtZW50cyUyRnVwbG9hZCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmRvY3VtZW50cyUyRnVwbG9hZCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmxva2VzaCUyRkRvY3VtZW50cyUyRkFnZW50X0FybXklMkZFc3RpbWF0b3JfQUlfYWdlbnQlMkZmcm9udGVuZCUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZsb2tlc2glMkZEb2N1bWVudHMlMkZBZ2VudF9Bcm15JTJGRXN0aW1hdG9yX0FJX2FnZW50JTJGZnJvbnRlbmQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2dEO0FBQzdIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXN0aW1hdG9yLWFpLz80MTExIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9sb2tlc2gvRG9jdW1lbnRzL0FnZW50X0FybXkvRXN0aW1hdG9yX0FJX2FnZW50L2Zyb250ZW5kL2FwcC9hcGkvZG9jdW1lbnRzL3VwbG9hZC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZG9jdW1lbnRzL3VwbG9hZC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2RvY3VtZW50cy91cGxvYWRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2RvY3VtZW50cy91cGxvYWQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvbG9rZXNoL0RvY3VtZW50cy9BZ2VudF9Bcm15L0VzdGltYXRvcl9BSV9hZ2VudC9mcm9udGVuZC9hcHAvYXBpL2RvY3VtZW50cy91cGxvYWQvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2RvY3VtZW50cy91cGxvYWQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Fupload%2Froute&page=%2Fapi%2Fdocuments%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Fupload%2Froute.ts&appDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/documents/upload/route.ts":
/*!*******************************************!*\
  !*** ./app/api/documents/upload/route.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\n\n// Debug logging for environment variables\nconsole.log(\"API Route Environment Check:\", {\n    hasOpenAIKey: !!process.env.OPENAI_API_KEY,\n    openAIKeyLength: process.env.OPENAI_API_KEY?.length || 0,\n    openAIKeyPrefix: process.env.OPENAI_API_KEY?.substring(0, 7)\n});\n// Initialize OpenAI with error handling\nlet openai;\ntry {\n    if (!process.env.OPENAI_API_KEY) {\n        throw new Error(\"OPENAI_API_KEY is not set in environment variables\");\n    }\n    openai = new openai__WEBPACK_IMPORTED_MODULE_4__.OpenAI({\n        apiKey: process.env.OPENAI_API_KEY\n    });\n} catch (error) {\n    console.error(\"Error initializing OpenAI:\", error);\n    throw error;\n}\nconst MAX_IMAGE_SIZE = 20 * 1024 * 1024; // 20MB\nconst SUPPORTED_IMAGE_TYPES = [\n    \"image/png\",\n    \"image/jpeg\",\n    \"image/jpg\"\n];\nconst SUPPORTED_TEXT_TYPES = [\n    \"application/pdf\",\n    \"application/msword\",\n    \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n    \"text/plain\"\n];\nasync function POST(request) {\n    try {\n        console.log(\"Starting document upload process...\");\n        const formData = await request.formData();\n        const file = formData.get(\"file\");\n        if (!file) {\n            console.error(\"No file provided in request\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No file provided\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"File received:\", {\n            name: file.name,\n            type: file.type,\n            size: file.size\n        });\n        // Ensure upload directory exists\n        const uploadDir = (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(process.cwd(), \"uploads\");\n        console.log(\"Upload directory path:\", uploadDir);\n        try {\n            if (!(0,fs__WEBPACK_IMPORTED_MODULE_3__.existsSync)(uploadDir)) {\n                console.log(\"Creating upload directory...\");\n                await (0,fs_promises__WEBPACK_IMPORTED_MODULE_1__.mkdir)(uploadDir, {\n                    recursive: true\n                });\n            }\n        } catch (dirError) {\n            console.error(\"Error creating upload directory:\", dirError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create upload directory\",\n                details: dirError instanceof Error ? dirError.message : \"Unknown error\"\n            }, {\n                status: 500\n            });\n        }\n        // Save the file temporarily\n        let buffer;\n        try {\n            const bytes = await file.arrayBuffer();\n            buffer = Buffer.from(bytes);\n            const filePath = (0,path__WEBPACK_IMPORTED_MODULE_2__.join)(uploadDir, file.name);\n            console.log(\"Saving file to:\", filePath);\n            await (0,fs_promises__WEBPACK_IMPORTED_MODULE_1__.writeFile)(filePath, buffer);\n        } catch (fileError) {\n            console.error(\"Error saving file:\", fileError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to save file\",\n                details: fileError instanceof Error ? fileError.message : \"Unknown error\"\n            }, {\n                status: 500\n            });\n        }\n        // Detect file type\n        const isImage = file.type.startsWith(\"image/\");\n        const isText = SUPPORTED_TEXT_TYPES.includes(file.type);\n        console.log(\"File type detection:\", {\n            isImage,\n            isText,\n            fileType: file.type\n        });\n        // File type/size checks\n        if (isImage) {\n            if (!SUPPORTED_IMAGE_TYPES.includes(file.type)) {\n                console.error(\"Unsupported image type:\", file.type);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Unsupported image type: ${file.type}`\n                }, {\n                    status: 400\n                });\n            }\n            if (buffer.length > MAX_IMAGE_SIZE) {\n                console.error(\"File too large:\", buffer.length);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Image file too large. Max 20MB allowed.\"\n                }, {\n                    status: 400\n                });\n            }\n        } else if (!isText) {\n            console.error(\"Unsupported file type:\", file.type);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Unsupported file type: ${file.type}`\n            }, {\n                status: 400\n            });\n        }\n        let completion;\n        console.log(\"Processing with OpenAI...\");\n        try {\n            if (isImage) {\n                // For images, use vision model\n                const base64 = buffer.toString(\"base64\");\n                const dataUrl = `data:${file.type};base64,${base64}`;\n                console.log(\"Using GPT-4 Vision for image analysis\");\n                completion = await openai.chat.completions.create({\n                    model: process.env.OPENAI_MODEL || \"gpt-4o-mini\",\n                    messages: [\n                        {\n                            role: \"system\",\n                            content: \"You are a document analysis expert. Extract all text from the image and summarize the project requirements. Return the analysis in a structured format.\"\n                        },\n                        {\n                            role: \"user\",\n                            content: [\n                                {\n                                    type: \"text\",\n                                    text: \"Please extract and analyze this document image.\"\n                                },\n                                {\n                                    type: \"image_url\",\n                                    image_url: {\n                                        url: dataUrl\n                                    }\n                                }\n                            ]\n                        }\n                    ],\n                    max_tokens: 4096\n                });\n            } else {\n                // For text-based files, use standard GPT-4\n                const fileContent = buffer.toString(\"utf-8\");\n                console.log(\"Using GPT-4 Turbo for text analysis\");\n                completion = await openai.chat.completions.create({\n                    model: process.env.OPENAI_MODEL || \"gpt-4o-mini\",\n                    messages: [\n                        {\n                            role: \"system\",\n                            content: \"You are a document analysis expert. Analyze the following document and extract key information about the project, including building specifications, requirements, and any relevant technical details. Return the analysis in a structured JSON format.\"\n                        },\n                        {\n                            role: \"user\",\n                            content: fileContent\n                        }\n                    ],\n                    response_format: {\n                        type: \"json_object\"\n                    }\n                });\n            }\n        } catch (aiError) {\n            console.error(\"OpenAI API Error:\", {\n                error: aiError,\n                message: aiError?.message,\n                response: aiError?.response?.data\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to process with OpenAI\",\n                details: aiError?.message || \"Unknown error\",\n                openaiError: aiError?.response?.data\n            }, {\n                status: 500\n            });\n        }\n        console.log(\"OpenAI processing completed\");\n        const content = completion.choices[0].message.content;\n        if (!content) {\n            console.error(\"No content received from OpenAI\");\n            throw new Error(\"No content received from OpenAI\");\n        }\n        let analysis;\n        try {\n            // For text documents, the response is already JSON\n            // For images, we need to parse any structured data from the text response\n            analysis = isImage ? {\n                extractedText: content\n            } : JSON.parse(content);\n            console.log(\"Analysis parsed successfully\");\n        } catch (parseError) {\n            console.error(\"Error parsing OpenAI response:\", parseError);\n            analysis = {\n                rawContent: content\n            };\n        }\n        console.log(\"Sending successful response\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            documentType: file.type,\n            extractedData: analysis,\n            confidence: 0.95,\n            url: isImage ? `data:${file.type};base64,${buffer.toString(\"base64\")}` : undefined\n        });\n    } catch (error) {\n        console.error(\"Unhandled error in document processing:\", {\n            error,\n            message: error?.message,\n            stack: error?.stack\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to process document\",\n            details: error?.message || \"Unknown error\",\n            stack:  true ? error?.stack : 0\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2RvY3VtZW50cy91cGxvYWQvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ3hCO0FBQ2U7QUFDbkI7QUFDSTtBQUVoQywwQ0FBMEM7QUFDMUNNLFFBQVFDLEdBQUcsQ0FBQyxnQ0FBZ0M7SUFDMUNDLGNBQWMsQ0FBQyxDQUFDQyxRQUFRQyxHQUFHLENBQUNDLGNBQWM7SUFDMUNDLGlCQUFpQkgsUUFBUUMsR0FBRyxDQUFDQyxjQUFjLEVBQUVFLFVBQVU7SUFDdkRDLGlCQUFpQkwsUUFBUUMsR0FBRyxDQUFDQyxjQUFjLEVBQUVJLFVBQVUsR0FBRztBQUM1RDtBQUVBLHdDQUF3QztBQUN4QyxJQUFJQztBQUNKLElBQUk7SUFDRixJQUFJLENBQUNQLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYyxFQUFFO1FBQy9CLE1BQU0sSUFBSU0sTUFBTTtJQUNsQjtJQUNBRCxTQUFTLElBQUlmLDBDQUFNQSxDQUFDO1FBQ2xCaUIsUUFBUVQsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO0lBQ3BDO0FBQ0YsRUFBRSxPQUFPUSxPQUFPO0lBQ2RiLFFBQVFhLEtBQUssQ0FBQyw4QkFBOEJBO0lBQzVDLE1BQU1BO0FBQ1I7QUFFQSxNQUFNQyxpQkFBaUIsS0FBSyxPQUFPLE1BQU0sT0FBTztBQUNoRCxNQUFNQyx3QkFBd0I7SUFBQztJQUFhO0lBQWM7Q0FBWTtBQUN0RSxNQUFNQyx1QkFBdUI7SUFDM0I7SUFDQTtJQUNBO0lBQ0E7Q0FDRDtBQUVNLGVBQWVDLEtBQUtDLE9BQW9CO0lBQzdDLElBQUk7UUFDRmxCLFFBQVFDLEdBQUcsQ0FBQztRQUVaLE1BQU1rQixXQUFXLE1BQU1ELFFBQVFDLFFBQVE7UUFDdkMsTUFBTUMsT0FBT0QsU0FBU0UsR0FBRyxDQUFDO1FBRTFCLElBQUksQ0FBQ0QsTUFBTTtZQUNUcEIsUUFBUWEsS0FBSyxDQUFDO1lBQ2QsT0FBT25CLHFEQUFZQSxDQUFDNEIsSUFBSSxDQUN0QjtnQkFBRVQsT0FBTztZQUFt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O1lBQ1BrQixTQUFTbEIsT0FBT21CLFdBQVc7WUFDM0I4QyxPQUFPM0UsS0FBeUIsR0FBZ0JVLE9BQU9pRSxRQUFRRCxDQUFTQTtRQUMxRSxHQUNBO1lBQUV0RCxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2VzdGltYXRvci1haS8uL2FwcC9hcGkvZG9jdW1lbnRzL3VwbG9hZC9yb3V0ZS50cz9kMThkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBPcGVuQUkgfSBmcm9tICdvcGVuYWknO1xuaW1wb3J0IHsgd3JpdGVGaWxlLCBta2RpciB9IGZyb20gJ2ZzL3Byb21pc2VzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5cbi8vIERlYnVnIGxvZ2dpbmcgZm9yIGVudmlyb25tZW50IHZhcmlhYmxlc1xuY29uc29sZS5sb2coJ0FQSSBSb3V0ZSBFbnZpcm9ubWVudCBDaGVjazonLCB7XG4gIGhhc09wZW5BSUtleTogISFwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbiAgb3BlbkFJS2V5TGVuZ3RoOiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWT8ubGVuZ3RoIHx8IDAsXG4gIG9wZW5BSUtleVByZWZpeDogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVk/LnN1YnN0cmluZygwLCA3KVxufSk7XG5cbi8vIEluaXRpYWxpemUgT3BlbkFJIHdpdGggZXJyb3IgaGFuZGxpbmdcbmxldCBvcGVuYWk6IE9wZW5BSTtcbnRyeSB7XG4gIGlmICghcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ09QRU5BSV9BUElfS0VZIGlzIG5vdCBzZXQgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzJyk7XG4gIH1cbiAgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gICAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbiAgfSk7XG59IGNhdGNoIChlcnJvcikge1xuICBjb25zb2xlLmVycm9yKCdFcnJvciBpbml0aWFsaXppbmcgT3BlbkFJOicsIGVycm9yKTtcbiAgdGhyb3cgZXJyb3I7XG59XG5cbmNvbnN0IE1BWF9JTUFHRV9TSVpFID0gMjAgKiAxMDI0ICogMTAyNDsgLy8gMjBNQlxuY29uc3QgU1VQUE9SVEVEX0lNQUdFX1RZUEVTID0gWydpbWFnZS9wbmcnLCAnaW1hZ2UvanBlZycsICdpbWFnZS9qcGcnXTtcbmNvbnN0IFNVUFBPUlRFRF9URVhUX1RZUEVTID0gW1xuICAnYXBwbGljYXRpb24vcGRmJyxcbiAgJ2FwcGxpY2F0aW9uL21zd29yZCcsXG4gICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCcsXG4gICd0ZXh0L3BsYWluJyxcbl07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIGRvY3VtZW50IHVwbG9hZCBwcm9jZXNzLi4uJyk7XG4gICAgXG4gICAgY29uc3QgZm9ybURhdGEgPSBhd2FpdCByZXF1ZXN0LmZvcm1EYXRhKCk7XG4gICAgY29uc3QgZmlsZSA9IGZvcm1EYXRhLmdldCgnZmlsZScpIGFzIEZpbGU7XG5cbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGZpbGUgcHJvdmlkZWQgaW4gcmVxdWVzdCcpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTm8gZmlsZSBwcm92aWRlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdGaWxlIHJlY2VpdmVkOicsIHtcbiAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgIHR5cGU6IGZpbGUudHlwZSxcbiAgICAgIHNpemU6IGZpbGUuc2l6ZVxuICAgIH0pO1xuXG4gICAgLy8gRW5zdXJlIHVwbG9hZCBkaXJlY3RvcnkgZXhpc3RzXG4gICAgY29uc3QgdXBsb2FkRGlyID0gam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkcycpO1xuICAgIGNvbnNvbGUubG9nKCdVcGxvYWQgZGlyZWN0b3J5IHBhdGg6JywgdXBsb2FkRGlyKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgaWYgKCFleGlzdHNTeW5jKHVwbG9hZERpcikpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIHVwbG9hZCBkaXJlY3RvcnkuLi4nKTtcbiAgICAgICAgYXdhaXQgbWtkaXIodXBsb2FkRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChkaXJFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgdXBsb2FkIGRpcmVjdG9yeTonLCBkaXJFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHVwbG9hZCBkaXJlY3RvcnknLCBkZXRhaWxzOiBkaXJFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZGlyRXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gU2F2ZSB0aGUgZmlsZSB0ZW1wb3JhcmlseVxuICAgIGxldCBidWZmZXI6IEJ1ZmZlcjtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYnl0ZXMgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XG4gICAgICBidWZmZXIgPSBCdWZmZXIuZnJvbShieXRlcyk7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IGpvaW4odXBsb2FkRGlyLCBmaWxlLm5hbWUpO1xuICAgICAgY29uc29sZS5sb2coJ1NhdmluZyBmaWxlIHRvOicsIGZpbGVQYXRoKTtcbiAgICAgIGF3YWl0IHdyaXRlRmlsZShmaWxlUGF0aCwgYnVmZmVyKTtcbiAgICB9IGNhdGNoIChmaWxlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNhdmluZyBmaWxlOicsIGZpbGVFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gc2F2ZSBmaWxlJywgZGV0YWlsczogZmlsZUVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBmaWxlRXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0IGZpbGUgdHlwZVxuICAgIGNvbnN0IGlzSW1hZ2UgPSBmaWxlLnR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJyk7XG4gICAgY29uc3QgaXNUZXh0ID0gU1VQUE9SVEVEX1RFWFRfVFlQRVMuaW5jbHVkZXMoZmlsZS50eXBlKTtcbiAgICBjb25zb2xlLmxvZygnRmlsZSB0eXBlIGRldGVjdGlvbjonLCB7IGlzSW1hZ2UsIGlzVGV4dCwgZmlsZVR5cGU6IGZpbGUudHlwZSB9KTtcblxuICAgIC8vIEZpbGUgdHlwZS9zaXplIGNoZWNrc1xuICAgIGlmIChpc0ltYWdlKSB7XG4gICAgICBpZiAoIVNVUFBPUlRFRF9JTUFHRV9UWVBFUy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Vuc3VwcG9ydGVkIGltYWdlIHR5cGU6JywgZmlsZS50eXBlKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgZXJyb3I6IGBVbnN1cHBvcnRlZCBpbWFnZSB0eXBlOiAke2ZpbGUudHlwZX1gIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYnVmZmVyLmxlbmd0aCA+IE1BWF9JTUFHRV9TSVpFKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZpbGUgdG9vIGxhcmdlOicsIGJ1ZmZlci5sZW5ndGgpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ0ltYWdlIGZpbGUgdG9vIGxhcmdlLiBNYXggMjBNQiBhbGxvd2VkLicgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFpc1RleHQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1Vuc3VwcG9ydGVkIGZpbGUgdHlwZTonLCBmaWxlLnR5cGUpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBgVW5zdXBwb3J0ZWQgZmlsZSB0eXBlOiAke2ZpbGUudHlwZX1gIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBsZXQgY29tcGxldGlvbjtcbiAgICBjb25zb2xlLmxvZygnUHJvY2Vzc2luZyB3aXRoIE9wZW5BSS4uLicpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChpc0ltYWdlKSB7XG4gICAgICAgIC8vIEZvciBpbWFnZXMsIHVzZSB2aXNpb24gbW9kZWxcbiAgICAgICAgY29uc3QgYmFzZTY0ID0gYnVmZmVyLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgICAgY29uc3QgZGF0YVVybCA9IGBkYXRhOiR7ZmlsZS50eXBlfTtiYXNlNjQsJHtiYXNlNjR9YDtcbiAgICAgICAgY29uc29sZS5sb2coJ1VzaW5nIEdQVC00IFZpc2lvbiBmb3IgaW1hZ2UgYW5hbHlzaXMnKTtcbiAgICAgICAgY29tcGxldGlvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICAgICAgbW9kZWw6IHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTCB8fCAnZ3B0LTRvLW1pbmknLFxuICAgICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJvbGU6ICdzeXN0ZW0nLFxuICAgICAgICAgICAgICBjb250ZW50OiAnWW91IGFyZSBhIGRvY3VtZW50IGFuYWx5c2lzIGV4cGVydC4gRXh0cmFjdCBhbGwgdGV4dCBmcm9tIHRoZSBpbWFnZSBhbmQgc3VtbWFyaXplIHRoZSBwcm9qZWN0IHJlcXVpcmVtZW50cy4gUmV0dXJuIHRoZSBhbmFseXNpcyBpbiBhIHN0cnVjdHVyZWQgZm9ybWF0LidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCB0ZXh0OiAnUGxlYXNlIGV4dHJhY3QgYW5kIGFuYWx5emUgdGhpcyBkb2N1bWVudCBpbWFnZS4nIH0sXG4gICAgICAgICAgICAgICAgeyB0eXBlOiAnaW1hZ2VfdXJsJywgaW1hZ2VfdXJsOiB7IHVybDogZGF0YVVybCB9IH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgbWF4X3Rva2VuczogNDA5NlxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZvciB0ZXh0LWJhc2VkIGZpbGVzLCB1c2Ugc3RhbmRhcmQgR1BULTRcbiAgICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSBidWZmZXIudG9TdHJpbmcoJ3V0Zi04Jyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdVc2luZyBHUFQtNCBUdXJibyBmb3IgdGV4dCBhbmFseXNpcycpO1xuICAgICAgICBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgICBtb2RlbDogcHJvY2Vzcy5lbnYuT1BFTkFJX01PREVMIHx8ICdncHQtNG8tbWluaScsXG4gICAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcm9sZTogJ3N5c3RlbScsXG4gICAgICAgICAgICAgIGNvbnRlbnQ6ICdZb3UgYXJlIGEgZG9jdW1lbnQgYW5hbHlzaXMgZXhwZXJ0LiBBbmFseXplIHRoZSBmb2xsb3dpbmcgZG9jdW1lbnQgYW5kIGV4dHJhY3Qga2V5IGluZm9ybWF0aW9uIGFib3V0IHRoZSBwcm9qZWN0LCBpbmNsdWRpbmcgYnVpbGRpbmcgc3BlY2lmaWNhdGlvbnMsIHJlcXVpcmVtZW50cywgYW5kIGFueSByZWxldmFudCB0ZWNobmljYWwgZGV0YWlscy4gUmV0dXJuIHRoZSBhbmFseXNpcyBpbiBhIHN0cnVjdHVyZWQgSlNPTiBmb3JtYXQuJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgICBjb250ZW50OiBmaWxlQ29udGVudFxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzcG9uc2VfZm9ybWF0OiB7IHR5cGU6ICdqc29uX29iamVjdCcgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChhaUVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ09wZW5BSSBBUEkgRXJyb3I6Jywge1xuICAgICAgICBlcnJvcjogYWlFcnJvcixcbiAgICAgICAgbWVzc2FnZTogYWlFcnJvcj8ubWVzc2FnZSxcbiAgICAgICAgcmVzcG9uc2U6IGFpRXJyb3I/LnJlc3BvbnNlPy5kYXRhXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBcbiAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBwcm9jZXNzIHdpdGggT3BlbkFJJyxcbiAgICAgICAgICBkZXRhaWxzOiBhaUVycm9yPy5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgICBvcGVuYWlFcnJvcjogYWlFcnJvcj8ucmVzcG9uc2U/LmRhdGFcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdPcGVuQUkgcHJvY2Vzc2luZyBjb21wbGV0ZWQnKTtcbiAgICBjb25zdCBjb250ZW50ID0gY29tcGxldGlvbi5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudDtcbiAgICBpZiAoIWNvbnRlbnQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGNvbnRlbnQgcmVjZWl2ZWQgZnJvbSBPcGVuQUknKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gY29udGVudCByZWNlaXZlZCBmcm9tIE9wZW5BSScpO1xuICAgIH1cblxuICAgIGxldCBhbmFseXNpcztcbiAgICB0cnkge1xuICAgICAgLy8gRm9yIHRleHQgZG9jdW1lbnRzLCB0aGUgcmVzcG9uc2UgaXMgYWxyZWFkeSBKU09OXG4gICAgICAvLyBGb3IgaW1hZ2VzLCB3ZSBuZWVkIHRvIHBhcnNlIGFueSBzdHJ1Y3R1cmVkIGRhdGEgZnJvbSB0aGUgdGV4dCByZXNwb25zZVxuICAgICAgYW5hbHlzaXMgPSBpc0ltYWdlID8geyBleHRyYWN0ZWRUZXh0OiBjb250ZW50IH0gOiBKU09OLnBhcnNlKGNvbnRlbnQpO1xuICAgICAgY29uc29sZS5sb2coJ0FuYWx5c2lzIHBhcnNlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIE9wZW5BSSByZXNwb25zZTonLCBwYXJzZUVycm9yKTtcbiAgICAgIGFuYWx5c2lzID0geyByYXdDb250ZW50OiBjb250ZW50IH07XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1NlbmRpbmcgc3VjY2Vzc2Z1bCByZXNwb25zZScpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBkb2N1bWVudFR5cGU6IGZpbGUudHlwZSxcbiAgICAgIGV4dHJhY3RlZERhdGE6IGFuYWx5c2lzLFxuICAgICAgY29uZmlkZW5jZTogMC45NSwgLy8gVGhpcyB3b3VsZCBiZSBjYWxjdWxhdGVkIGJhc2VkIG9uIHRoZSBhbmFseXNpc1xuICAgICAgdXJsOiBpc0ltYWdlID8gYGRhdGE6JHtmaWxlLnR5cGV9O2Jhc2U2NCwke2J1ZmZlci50b1N0cmluZygnYmFzZTY0Jyl9YCA6IHVuZGVmaW5lZFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIGVycm9yIGluIGRvY3VtZW50IHByb2Nlc3Npbmc6Jywge1xuICAgICAgZXJyb3IsXG4gICAgICBtZXNzYWdlOiBlcnJvcj8ubWVzc2FnZSxcbiAgICAgIHN0YWNrOiBlcnJvcj8uc3RhY2tcbiAgICB9KTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IFxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBwcm9jZXNzIGRvY3VtZW50JyxcbiAgICAgICAgZGV0YWlsczogZXJyb3I/Lm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InLFxuICAgICAgICBzdGFjazogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvcj8uc3RhY2sgOiB1bmRlZmluZWRcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJPcGVuQUkiLCJ3cml0ZUZpbGUiLCJta2RpciIsImpvaW4iLCJleGlzdHNTeW5jIiwiY29uc29sZSIsImxvZyIsImhhc09wZW5BSUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsIm9wZW5BSUtleUxlbmd0aCIsImxlbmd0aCIsIm9wZW5BSUtleVByZWZpeCIsInN1YnN0cmluZyIsIm9wZW5haSIsIkVycm9yIiwiYXBpS2V5IiwiZXJyb3IiLCJNQVhfSU1BR0VfU0laRSIsIlNVUFBPUlRFRF9JTUFHRV9UWVBFUyIsIlNVUFBPUlRFRF9URVhUX1RZUEVTIiwiUE9TVCIsInJlcXVlc3QiLCJmb3JtRGF0YSIsImZpbGUiLCJnZXQiLCJqc29uIiwic3RhdHVzIiwibmFtZSIsInR5cGUiLCJzaXplIiwidXBsb2FkRGlyIiwiY3dkIiwicmVjdXJzaXZlIiwiZGlyRXJyb3IiLCJkZXRhaWxzIiwibWVzc2FnZSIsImJ1ZmZlciIsImJ5dGVzIiwiYXJyYXlCdWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwiZmlsZVBhdGgiLCJmaWxlRXJyb3IiLCJpc0ltYWdlIiwic3RhcnRzV2l0aCIsImlzVGV4dCIsImluY2x1ZGVzIiwiZmlsZVR5cGUiLCJjb21wbGV0aW9uIiwiYmFzZTY0IiwidG9TdHJpbmciLCJkYXRhVXJsIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibW9kZWwiLCJPUEVOQUlfTU9ERUwiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidGV4dCIsImltYWdlX3VybCIsInVybCIsIm1heF90b2tlbnMiLCJmaWxlQ29udGVudCIsInJlc3BvbnNlX2Zvcm1hdCIsImFpRXJyb3IiLCJyZXNwb25zZSIsImRhdGEiLCJvcGVuYWlFcnJvciIsImNob2ljZXMiLCJhbmFseXNpcyIsImV4dHJhY3RlZFRleHQiLCJKU09OIiwicGFyc2UiLCJwYXJzZUVycm9yIiwicmF3Q29udGVudCIsImRvY3VtZW50VHlwZSIsImV4dHJhY3RlZERhdGEiLCJjb25maWRlbmNlIiwidW5kZWZpbmVkIiwic3RhY2siXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/documents/upload/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/next","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Fupload%2Froute&page=%2Fapi%2Fdocuments%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Fupload%2Froute.ts&appDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Flokesh%2FDocuments%2FAgent_Army%2FEstimator_AI_agent%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();